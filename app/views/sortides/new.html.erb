<%= form_with(model: @sortide, class: "contents text-xsm md:text-sm") do |form| %>
  <%= current_user.puntuacio.to_i %>
  <div class="mx-auto md:w-2/3 w-full mb-6 border border-lime-600 rounded-md p-4 m-4">
    <h1 class="font-bold text-2xl md:text-4xl text-lime-600 py-2 text-center"><span class='text-xl mx-2'> <i class="fas fa-motorcycle"></i></span> Nova sortida</h1>
    <% if @sortide.errors.any? %>
      <div id="error_explanation" class="bg-red-50 text-red-500 px-3 py-2 font-medium rounded-lg mt-3">
        <h2 class="text-sm md:text-base"><%= pluralize(@sortide.errors.count, "error") %> prohibit sortide de ser creada:</h2>
        <ul class="text-sm md:text-base">
          <% @sortide.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>
    <small>
      <div class="my-5 p-4 border border-lime-600 rounded-md">
        <div class="flex space-x-4">
          <div class="flex-1">
            <%= form.label :Data, class: "text-sm md:text-base" %>
            <%= form.date_field :start_date, class: "block shadow-xs rounded-md border border-gray-400 outline-hidden px-3 py-2 mt-2 w-full text-sm md:text-base" %>
          </div>
          <div class="flex-1">
            <%= form.label :Hora, class: "text-sm md:text-base" %>
            <%= form.time_field :start_time, class: "block shadow-xs rounded-md border border-gray-400 outline-hidden px-3 py-2 mt-2 w-full text-sm md:text-base", step: 1800, value: @sortide.start_time&.strftime("%H:%M") || "09:00" %>
          </div>
        </div>
        <div class="mt-4">
          <%= form.label :Punt_trobada, class: "text-sm md:text-base" %>
          <%= form.text_field :start_point, class: "block shadow-xs rounded-md border border-gray-400 outline-hidden px-3 py-2 mt-2 w-full text-sm md:text-base" %>
        </div>
      </div>
      <div class="my-5">
        <%= form.label :Títol, class: "text-sm md:text-base" %>
        <%= form.text_field :title, class: "block shadow-xs rounded-md border border-gray-400 outline-hidden px-3 py-2 mt-2 w-full text-sm md:text-base" %>
      </div>
      <div class="my-5">
        <%= form.label :Descripció, class: "text-sm md:text-base" %>
        <%= form.rich_text_area :descripcio, rows: 6, class: "bg-white block shadow-xs rounded-md border border-gray-400 outline-hidden px-3 py-2 mt-2 w-full text-sm md:text-base" %>
      </div>
      <%= form.fields_for :sortideclass do |sortideclass_form| %>
        <div class="flex justify-center space-x-4 border border-lime-600 rounded-md p-4">
          <div class="flex-1">
            <%= sortideclass_form.label :category_id, class: "text-sm md:text-base" %>: 
            <%= sortideclass_form.collection_select :category_id, Category.all, :id, :name, {}, { class: "text-sm md:text-base" } %>
          </div>
          <div class="flex-1">
            <%= sortideclass_form.label :tipu_id, class: "text-sm md:text-base" %>: 
            <%= sortideclass_form.collection_select :tipu_id, Tipu.all, :id, :name, {}, { class: "text-sm md:text-base" } %>
          </div>
          <div class="flex-1">
            <%= sortideclass_form.label :ritme_id, class: "text-sm md:text-base" %>: 
            <%= sortideclass_form.collection_select :ritme_id, Ritme.all, :id, :name, {}, { class: "text-sm md:text-base" } %>
          </div>
        </div>
      <% end %>
      <div class="my-5">
        <%= form.label :ruta_foto, class: "text-sm md:text-base" %>
        <% if @sortide.persisted? && @sortide.ruta_foto.attached? %>
          <div class="my-2">
            <%= image_tag @sortide.ruta_foto, class: "w-24 h-24 rounded-md border border-gray-400" %>
          </div>
        <% end %>
        <%= form.file_field :ruta_foto, class: "block shadow-xs rounded-md border border-gray-400 outline-hidden px-3 py-2 mt-2 w-full text-sm md:text-base" %>
      </div>
      <!-- GPX -->
      <div class="my-5">
        <%= form.label :ruta_gpx, class: "text-sm md:text-base" %>
        <% if @sortide.ruta_gpx.attached? %>
          <div class="my-2">
            <%= %>
          </div>
        <% end %>
        <%= form.file_field :ruta_gpx, class: "btn-sm" %>
      </div>
      <!-- ./GPX -->
      <div class="my-5">
        <span class='mr-4 text-sm md:text-base'>Ruta: <%= @sortide.Km %><%= form.label :Km, class: "text-sm md:text-base" %></span>
        <%= form.select :Km, options_for_select([['1-50', 25], ['51-100', 75], ['101-150', 125], ['151-200', 175], ['201-250', 225], ['251-300', 275], ['301-350', 325], ['351-400', 375], ['401-450', 425], ['451-500', 475], ['501-600', 550], ['601-1000', 800], ['1001-1500', 1250], ['1501-2000', 1750], ['2001-2500', 2250], ['2501-3000', 2750], ['+3001', 3250]], @sortide.Km), class: "block shadow-xs rounded-md border border-gray-400 outline-hidden px-3 py-2 mt-2 w-full text-sm md:text-base" %>
      </div>
      <div class="my-5">
        <%= form.label :Títol_curt_proposat, class: "text-sm md:text-base" %>:
        <%= if (@sortide.start_date.present? && @sortide.title.present?) 
          @sortide.start_date.strftime('%Y%m%d') + "_" + @sortide.title[0, 15].gsub(/\b(a|la|el|en|de)\b/, '').gsub(/[^\w\s]/, '').gsub(/\s+/, '')
        else
          "AAAAMMDD_Destí (<20 caràcters), exemple: 20250625_MontNou"
        end %>
        <%= form.text_field :slug, value: @sortide.slug.present? && @sortide.title == @sortide.title_was ? @sortide.slug : (@sortide.start_date.present? ? (@sortide.start_date.strftime('%Y%m%d') + "_" + @sortide.title[0, 25].gsub(/\b(a|la|el|en|i|els|les)\b/, '').gsub(/\s+/, '')) : ""), class: "block shadow-xs rounded-md border border-gray-400 outline-hidden px-3 py-2 mt-2 w-full text-sm md:text-base" %>
      </div>
      <div class="flex justify-center space-x-4 border border-lime-600 rounded-md p-4 m-2">
        <div class="my-5">
          <%= form.label :min_inscrits, "Minim numero d'inscrits", class: "text-sm md:text-base" %>:
          <%= form.number_field :min_inscrits, class: "block shadow-xs rounded-md border border-gray-400 outline-hidden px-3 py-2 mt-2 w-full text-sm md:text-base" %>
        </div>
        <div class="my-5">
          <%= form.label :max_inscrits, "Maxim numero d'inscrits", class: "text-sm md:text-base" %>
          <%= form.number_field :max_inscrits, class: "block shadow-xs rounded-md border border-gray-400 outline-hidden px-3 py-2 mt-2 w-full text-sm md:text-base" %>
        </div>
        <div class="my-5">
          <%= form.label :preu, "Preu de l'inscripció (€):", class: "text-sm md:text-base" %>
          <%= form.number_field :preu, step: 2, min: 0, class: "block shadow-xs rounded-md border border-gray-400 outline-hidden mt-2 p-2 w-full text-sm md:text-base" %>
          <button type="button" class="ml-2 text-blue-500 text-sm md:text-base" onclick="togglePopup()">More Info</button>
        </div>
        <div id="popup" class="fixed inset-0 flex items-center justify-center bg-gray-800 bg-opacity-50 hidden">
          <div class="bg-white p-5 rounded-lg shadow-lg">
            <h2 class="text-xl font-bold mb-4">Preu de l'inscripció (€):</h2>
            <p>Els preus de l'inscripció <a href="/">Veure + informacio</a>.</p>
            <button type="button" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded-xs" onclick="togglePopup()">Close</button>
          </div>
        </div>
      </div>
    </small>
    <div class="flex justify-center space-x-4 border border-lime-600 rounded-md p-4 m-2 mb-4">
      <div class="my-5">
        <%= form.label :num_dies, "Durada en numero de dies", class: "text-sm md:text-base" %>
        <%= form.number_field :num_dies, class: "block shadow-xs rounded-md border border-gray-400 outline-hidden px-3 py-2 mt-2 w-full text-sm md:text-base" %>
      </div>
      <div class="my-5">
        <%= form.label :fi_ndies, "Numero de dies abans pel tancament d'inscripcions", class: "text-sm md:text-base" %>
        <%= form.number_field :fi_ndies, class: "block shadow-xs rounded-md border border-gray-400 outline-hidden px-3 py-2 mt-2 w-full text-sm md:text-base" %>
      </div>
      <div class="my-5">
        <%= form.label :oberta %>
        <%= form.check_box :oberta, class: "block mt-2 h-5 w-5" %>
      </div>
    </div>
  </div>
  <div class="flex justify-center space-x-4 mb-6">
    <%= form.submit "Crea Sortida", class: "rounded-lg py-1 px-2 bg-lime-700 hover:bg-lime-800 text-white inline-block font-medium cursor-pointer text-sm md:text-base" %>
    <%= link_to "Sortides", sortides_path, class: "ml-2 rounded-lg py-2 px-3 bg-gray-100 border border-gray-400 inline-block font-medium text-sm md:text-base" %>
  </div>
<% end %>